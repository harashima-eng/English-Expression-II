<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Grammar Breakdown 14ï½œå¦å®šãƒ»ç‰¹æ®Šæ§‹æ–‡</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    *{margin:0;padding:0;box-sizing:border-box;}
    :root{
      --bg:#f3f4f6; --bg-card:#ffffff; --text:#0f172a; --text-soft:#475569;
      --accent:#4f46e5; --accent-soft: rgba(79,70,229,.10); --border:#e2e8f0;
      --hint:#2563eb; --answer:#16a34a; --glow:#facc15; --shadow:0 12px 35px rgba(15,23,42,.12);
      --warn:#f59e0b;
    }
    body.dark{
      --bg:#020617; --bg-card:#0b1220; --text:#e5e7eb; --text-soft:#94a3b8;
      --accent:#818cf8; --accent-soft: rgba(129,140,248,.14); --border:#111827;
      --shadow:0 12px 35px rgba(0,0,0,.45);
    }
    body{
      font-family: system-ui, -apple-system, "Segoe UI","Hiragino Kaku Gothic ProN","Yu Gothic", sans-serif;
      background: radial-gradient(circle at top left,#6366f1 0,#0f172a 45%, #020617 100%);
      color:var(--text); padding:14px; min-height:100vh;
    }
    .shell{
      max-width:1400px; margin:0 auto; background:var(--bg); border-radius:22px; overflow:hidden;
      border:1px solid rgba(148,163,184,.35); box-shadow:0 30px 80px rgba(15,23,42,.40);
    }
    header{
      background: linear-gradient(135deg, rgba(15,23,42,.98), rgba(30,64,175,.96));
      color:#e5e7eb; padding:16px 18px; border-bottom:1px solid rgba(148,163,184,.35);
      display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;
    }
    header h1{font-size:1.25rem;letter-spacing:.03em;}
    header .sub{font-size:.85rem;color:#cbd5f5;}
    .btn{
      cursor:pointer;border:none;outline:none; padding:7px 12px;border-radius:999px; font-size:.82rem;font-weight:600;
      display:inline-flex;align-items:center;gap:6px; background:rgba(15,23,42,.8);
      color:#e5e7eb;border:1px solid rgba(148,163,184,.7); transition:.18s ease;
    }
    .btn:hover{background:rgba(30,64,175,.95);transform:translateY(-1px);}
    .topbar{
      padding:10px 12px; background:var(--bg); border-bottom:1px solid var(--border);
      display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;
      font-size:.82rem;color:var(--text-soft);
    }
    .columns{
      display:flex;gap:12px; height: calc(100vh - 165px); max-height: 850px; padding:12px; transition:.2s ease;
    }
    .columns.one-col{ flex-direction:column; height:auto; max-height:none; }
    .pane{
      flex:1; background:var(--bg-card); border:1px solid var(--border); border-radius:18px; padding:12px;
      overflow:auto; box-shadow:var(--shadow); scroll-behavior:smooth; position:relative;
    }
    .pane-title{
      font-size:.78rem;font-weight:800;letter-spacing:.08em;text-transform:uppercase;color:var(--text-soft);
      margin-bottom:8px;display:flex;align-items:center;justify-content:space-between;
    }
    .section{
      border:1px solid rgba(148,163,184,.4); background:rgba(148,163,184,.06); border-radius:14px; padding:10px; margin-bottom:10px;
    }
    .section h2{ font-size:.95rem; display:flex; align-items:center; justify-content:space-between; margin-bottom:6px; }
    .tag{ font-size:.7rem;padding:2px 8px;border-radius:999px;background:var(--accent-soft);color:var(--accent);font-weight:700; }
    .q-item{
      padding:8px 8px 10px; margin-top:6px; border-top:1px dashed rgba(148,163,184,.6);
      border-radius:10px; position:relative;
    }
    .q-item:first-of-type{border-top:none;margin-top:0;}
    .q-label{font-weight:800;color:var(--accent);font-size:.9rem;margin-bottom:4px;}
    .q-jp{font-size:.86rem;color:var(--text-soft);margin-bottom:3px;}
    .q-en{font-size:.9rem;line-height:1.65;}
    .q-raw{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace;
      font-size:.84rem;background:rgba(15,23,42,.06); padding:6px;border-radius:8px;margin-top:4px; white-space:pre-wrap;
    }
    .q-highlight{
      background:transparent !important; border:2px solid var(--glow) !important;
      box-shadow:0 0 0 2px rgba(250,204,21,.25), 0 8px 20px rgba(15,23,42,.25);
    }
    .toggle-row{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px;}
    .mini{
      cursor:pointer;border:none;outline:none; padding:6px 10px;border-radius:999px;font-size:.78rem;font-weight:800;
      display:inline-flex;align-items:center;gap:6px; transition:.18s ease; border:1px solid var(--border);
      background:rgba(15,23,42,.04);color:var(--text);
    }
    .mini:hover{transform:translateY(-1px);background:var(--accent-soft);border-color:var(--accent);}
    .mini.hint{border-color:rgba(37,99,235,.35);}
    .mini.answer{border-color:rgba(22,163,74,.35);}
    .mini.warn{border-color:rgba(245,158,11,.5);}

    .ex{ margin-top:6px;display:grid;gap:8px; }
    .bubble{
      border-radius:14px;padding:10px 12px; border-left:6px solid transparent; background:rgba(15,23,42,.04);
      font-size:.9rem;line-height:1.7; box-shadow:0 6px 16px rgba(15,23,42,.08);
      transform-origin:top; transition:max-height .28s ease, opacity .22s ease, transform .22s ease;
      max-height:0;opacity:0;transform:translateY(-4px); overflow:hidden;
    }
    .bubble.open{max-height:800px;opacity:1;transform:translateY(0);}
    .bubble .label{font-weight:900;font-size:.8rem;letter-spacing:.03em;margin-bottom:4px;display:inline-flex;align-items:center;gap:6px;}
    .bubble.hint{ border-left-color:var(--hint); background:rgba(37,99,235,.08); }
    .bubble.answer{ border-left-color:var(--answer); background:rgba(22,163,74,.08); }
    .bubble.warn{ border-left-color:var(--warn); background:rgba(245,158,11,.10); }
    .bubble .jp{color:var(--text-soft);font-size:.85rem;margin-top:4px;}

    .columns.two-cols .merge-block{ display:none; }
    .columns.one-col #rightPane{display:none;}
    .merge-block{margin-top:8px;}

    @media (max-width:900px){ .columns{flex-direction:column;height:auto;max-height:none;} }
  
    /* --- UX v5 polish --- */
    .pane{
      scroll-behavior:auto; /* avoid smooth-scroll inertia during sync */
    }
    .columns.one-col .pane{
      scroll-behavior:smooth; /* in merge mode smooth is fine */
    }
    /* lock typography so left/right render the same */
    .q-item, .bubble, .q-en, .q-jp, .q-raw{
      font-size:.92rem;
      line-height:1.75;
      letter-spacing:.01em;
      font-kerning: normal;
      text-rendering: geometricPrecision;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    .q-jp{font-size:.9rem;}
    .q-raw{font-size:.88rem; line-height:1.7;}
    .bubble{font-size:.92rem;}
    .section{margin-bottom:14px;}
    .q-item{margin-top:10px; padding:10px 10px 12px;}
    .toggle-row{margin-top:8px;}
    .ex{margin-top:8px; gap:10px;}
    .mini{padding:7px 12px; font-size:.8rem;}
    .bubble{padding:12px 14px; border-radius:16px;}
    .section h2{margin-bottom:8px;}
    .pane-title{margin-bottom:10px;}

  </style>
</head>
<body>
<div class="shell">
  <header>
    <div>
      <h1>14 å¦å®šãƒ»ç‰¹æ®Šæ§‹æ–‡ï½œGrammar Breakdown</h1>
      <div class="sub">åŸºæœ¬å•é¡Œãƒ»For Communicationãƒ»ç™ºå±•å•é¡Œ</div>
    </div>
    <div style="display:flex;gap:8px;flex-wrap:wrap;">
      <button class="btn" id="themeBtn">ğŸŒ— Light / Dark</button>
      <button class="btn" id="layoutBtn">ğŸ“„ 1-Column (Merge)</button>
      <button class="btn" id="downloadBtn">ğŸ’¾ Download HTML</button>
    </div>
  </header>
  <div class="topbar">
    <div>â¬… å·¦ï¼šå•é¡Œã€€ï½œã€€å³ï¼šHint + Answer + è§£èª¬ â¡</div>
    <div style="font-size:.75rem;">PCã¯2ã‚«ãƒ©ãƒ ï¼ã‚¹ãƒãƒ›ã¯1ã‚«ãƒ©ãƒ (merge)ãŒè¦‹ã‚„ã™ã„</div>
  </div>

  <main class="columns one-col" id="columns">
    <section class="pane" id="leftPane">
      <div class="pane-title">Questions</div>

      <!-- CONTENT (same as v2) -->
      <div class="section">
        <h2>åŸºæœ¬å•é¡Œï¼‘ï½œèªå¥è£œå…… <span class="tag">Negation Basics</span></h2>
        <div class="q-item" data-qid="b1-1"><div class="q-label">(1)</div><div class="q-jp">ç§ãŸã¡ã®ä¼šç¤¾ã§å½¼ãŒè¾è·ã™ã‚‹ã“ã¨ã‚’çŸ¥ã£ã¦ã„ã‚‹äººã¯ã»ã¨ã‚“ã©ã„ãªã„ï¼</div><div class="q-en">(ã€€ã€€ã€€ã€€ã€€) people in our office know he is going to resign.</div><div class="merge-block"></div></div>
        <div class="q-item" data-qid="b1-2"><div class="q-label">(2)</div><div class="q-jp">ã‚«ã‚ºãƒ¤ã¯ãƒ”ã‚¢ãƒãŒä¸Šæ‰‹ã§ã™ï¼</div><div class="q-en">Kazuya is a (ã€€ã€€ã€€ã€€ã€€) (ã€€ã€€ã€€ã€€ã€€).</div><div class="merge-block"></div></div>
        <div class="q-item" data-qid="b1-3"><div class="q-label">(3)</div><div class="q-jp">ã‚‚ã—ãƒ‡ã‚£ãƒƒã‚¯ãŒãã®ç¥­ã‚Šã«è¡Œã‹ãªã„ã®ãªã‚‰ï¼Œåƒ•ã‚‚è¡Œã‹ãªã„ã‚ˆï¼</div><div class="q-en">If Dick doesnâ€™t go to the festival, I wonâ€™t, (ã€€ã€€ã€€ã€€ã€€).</div><div class="merge-block"></div></div>
        <div class="q-item" data-qid="b1-4"><div class="q-label">(4)</div><div class="q-jp">ä¼‘æš‡ä¸­ã¯ã‚ˆããŠä¼‘ã¿ã«ãªã‚Œã¾ã—ãŸã‹ï¼</div><div class="q-en">Did you have a (ã€€ã€€ã€€ã€€ã€€) (ã€€ã€€ã€€ã€€ã€€) during the holidays?</div><div class="merge-block"></div></div>
        <div class="q-item" data-qid="b1-5"><div class="q-label">(5)</div><div class="q-jp">ãã®ä½œå®¶ã¯ã‚ã£ãŸã«äººå‰ã«å§¿ã‚’è¦‹ã›ãªã„ï¼</div><div class="q-en">The writer (ã€€ã€€ã€€ã€€ã€€) appears in public.</div><div class="merge-block"></div></div>
      </div>

      <div class="section">
        <h2>åŸºæœ¬å•é¡Œï¼’ï½œæ›¸ãã‹ãˆ <span class="tag">Structures</span></h2>
        <div class="q-item" data-qid="b2-1"><div class="q-label">(1)</div><div class="q-en">Ben is most unlikely to betray us.<br>Ben would be (ã€€ã€€ã€€ã€€ã€€) (ã€€ã€€ã€€ã€€ã€€) person to betray us.</div><div class="merge-block"></div></div>
        <div class="q-item" data-qid="b2-2"><div class="q-label">(2)</div><div class="q-en">Some people are sure that ghosts exist.<br>Some people are sure of the (ã€€ã€€ã€€ã€€ã€€) (ã€€ã€€ã€€ã€€ã€€) ghosts.</div><div class="merge-block"></div></div>
        <div class="q-item" data-qid="b2-3"><div class="q-label">(3)</div><div class="q-en">I donâ€™t like any of these pictures.<br>I like (ã€€ã€€ã€€ã€€ã€€) (ã€€ã€€ã€€ã€€ã€€) these pictures.</div><div class="merge-block"></div></div>
        <div class="q-item" data-qid="b2-4"><div class="q-label">(4)</div><div class="q-en">Why did he change his mind?<br>What (ã€€ã€€ã€€ã€€ã€€) (ã€€ã€€ã€€ã€€ã€€) change his mind?</div><div class="merge-block"></div></div>
        <div class="q-item" data-qid="b2-5"><div class="q-label">(5)</div><div class="q-en">What you are saying is only an armchair theory.<br>What you are saying is (ã€€ã€€ã€€ã€€ã€€) (ã€€ã€€ã€€ã€€ã€€) an armchair theory.</div><div class="merge-block"></div></div>
        <div class="q-item" data-qid="b2-6"><div class="q-label">(6)</div><div class="q-en">Though they were tired, they went on working late.<br>(ã€€ã€€ã€€ã€€ã€€) (ã€€ã€€ã€€ã€€ã€€) they were, they went on working late.</div><div class="merge-block"></div></div>
      </div>

      <div class="section">
        <h2>åŸºæœ¬å•é¡Œï¼“ï½œè‹±â†’æ—¥ <span class="tag">Translation</span></h2>
        <div class="q-item" data-qid="b3-1"><div class="q-label">(1)</div><div class="q-en">I often go to the library, and so does my brother.</div><div class="merge-block"></div></div>
        <div class="q-item" data-qid="b3-2"><div class="q-label">(2)</div><div class="q-en">You should not despise people because they are not rich.</div><div class="merge-block"></div></div>
        <div class="q-item" data-qid="b3-3"><div class="q-label">(3)</div><div class="q-en">When angry, count to ten before you speak.</div><div class="merge-block"></div></div>
        <div class="q-item" data-qid="b3-4"><div class="q-label">(4)</div><div class="q-en">We have no choice but to wait for him here.</div><div class="merge-block"></div></div>
        <div class="q-item" data-qid="b3-5"><div class="q-label">(5)</div><div class="q-en">This computer can save us time and energy.</div><div class="merge-block"></div></div>
      </div>

      <div class="section">
        <h2>åŸºæœ¬å•é¡Œï¼”ï½œä¸¦ã¹ã‹ãˆ <span class="tag">Word Order</span></h2>
        <div class="q-item" data-qid="b4-1"><div class="q-label">(1)</div><div class="q-jp">ã‚‚ã£ã¨æ—©ãã«è‡ªå·±ç´¹ä»‹ã‚’ã—ãªãã¦ã™ã¿ã¾ã›ã‚“ï¼</div><div class="q-raw">Iâ€™m [ not, sooner, for, introducing, sorry, myself ].</div><div class="merge-block"></div></div>
        <div class="q-item" data-qid="b4-2"><div class="q-label">(2)</div><div class="q-jp">ã‚·ãƒ³ãƒ‡ãƒ¬ãƒ©ãŒèˆè¸ä¼šã§ã¯ã„ã¦ã„ãŸã®ã¯ã“ã®ã‚¬ãƒ©ã‚¹ã®é´ã ã£ãŸï¼</div><div class="q-raw">It [ Cinderella, glass slipper, that, this, was, wore ] at the ball.</div><div class="merge-block"></div></div>
        <div class="q-item" data-qid="b4-3"><div class="q-label">(3)</div><div class="q-jp">ç§ã¯ã‚‚ã¯ã‚„ãã®å¯’ã•ã«ã¯è€ãˆã‚‰ã‚Œãªã„ï¼</div><div class="q-raw">I [ the, any, stand, cold, longer, cannot ].</div><div class="merge-block"></div></div>
        <div class="q-item" data-qid="b4-4"><div class="q-label">(4)</div><div class="q-jp">ã‚ãªãŸã®ç€ã¦ã„ã‚‹Tã‚·ãƒ£ãƒ„ã‚’è¦‹ã‚‹ã¨ï¼Œè‡ªåˆ†ã®å›½ã‚’æ€ã„å‡ºã™ï¼</div><div class="q-raw">Your T-shirt [ of, my, me, country, reminds ].</div><div class="merge-block"></div></div>
      </div>

      <div class="section">
        <h2>åŸºæœ¬å•é¡Œï¼•ï½œè‹±ä½œ <span class="tag">Production</span></h2>
        <div class="q-item" data-qid="b5-1"><div class="q-label">(1)</div><div class="q-jp">ãã®å¥¨å­¦é‡‘ã®ãŠã‹ã’ã§å½¼ã¯å¤§å­¦ã«è¡Œãã“ã¨ãŒã§ããŸï¼</div><div class="merge-block"></div></div>
        <div class="q-item" data-qid="b5-2"><div class="q-label">(2)</div><div class="q-jp">ç§ã¯ã“ã‚“ãªç¾ã—ã„æ™¯è‰²ã‚’ã“ã‚Œã¾ã§è¦‹ãŸã“ã¨ãŒãªã„ï¼</div><div class="merge-block"></div></div>
        <div class="q-item" data-qid="b5-3"><div class="q-label">(3)</div><div class="q-jp">å½¼å¥³ã®æ‰‹ç´™ã«ã‚ˆã‚‹ã¨ï¼Œå½¼å¥³ã¯æ¥é€±æ—¥æœ¬ã«å¸°ã£ã¦ãã‚‹ãã†ã ï¼</div><div class="merge-block"></div></div>
        <div class="q-item" data-qid="b5-4"><div class="q-label">(4)</div><div class="q-jp">ç§ã®çˆ¶ã¯ã‚¿ãƒã‚³ã‚’å¸ã‚ãªã„ã—ï¼Œç§ã‚‚å¸ã‚ãªã„ï¼</div><div class="merge-block"></div></div>
        <div class="q-item" data-qid="b5-5"><div class="q-label">(5)</div><div class="q-jp">å½¼ã‚‰ãŒçµå©šã™ã‚‹ã¨ã„ã†ã†ã‚ã•ã‚’è€³ã«ã—ã¾ã—ãŸã‹ï¼</div><div class="merge-block"></div></div>
      </div>

      <div class="section">
        <h2>FOR COMMUNICATION <span class="tag">ä¼šè©±è¡¨ç¾</span></h2>
        <div class="q-item" data-qid="fc-1"><div class="q-label">(1)</div><div class="q-en">A: Whatâ€™s the matter? Are you hurt?<br>B: Yes, I slipped on the floor. I think my left arm is broken.<br>A: Oh! (ã€€ã€€ã€€).<br>a. I hope so / b. I hope not / c. Iâ€™m sorry not / d. Iâ€™m afraid not</div><div class="merge-block"></div></div>
        <div class="q-item" data-qid="fc-2"><div class="q-label">(2)</div><div class="q-en">A: Ken and Mary are getting married next week.<br>B: (ã€€ã€€ã€€)! They got to know each other just a week ago!<br>a. No kidding / b. No offense / c. No problem / d. No sweat</div><div class="merge-block"></div></div>
      </div>

      <div class="section">
        <h2>ç™ºå±•å•é¡Œï¼‘ï½œèªå¥é¸æŠ <span class="tag">å¤§å­¦å…¥è©¦</span></h2>
        <div class="q-item" data-qid="a1-1"><div class="q-label">(1)</div><div class="q-en">The accident I had yesterday was (ã€€ã€€ã€€) my control.<br>a. in / b. out / c. over / d. beyond</div><div class="merge-block"></div></div>
        <div class="q-item" data-qid="a1-2"><div class="q-label">(2)</div><div class="q-en">Susan is not a researcher and she is not a professor, (ã€€ã€€ã€€).<br>a. too / b. either / c. instead / d. also</div><div class="merge-block"></div></div>
        <div class="q-item" data-qid="a1-3"><div class="q-label">(3)</div><div class="q-en">The new tax system is (ã€€ã€€ã€€) but perfect.<br>a. anything / b. something / c. nothing / d. everything</div><div class="merge-block"></div></div>
        <div class="q-item" data-qid="a1-4"><div class="q-label">(4)</div><div class="q-en">The Internet has (ã€€ã€€ã€€) us to quickly contact even friends who are far away.<br>a. let / b. made / c. suggested / d. enabled</div><div class="merge-block"></div></div>
        <div class="q-item" data-qid="a1-5"><div class="q-label">(5)</div><div class="q-en">The food the restaurant offered us was (ã€€ã€€ã€€) from satisfying.<br>a. almost / b. close / c. all / d. far</div><div class="merge-block"></div></div>
        <div class="q-item" data-qid="a1-6"><div class="q-label">(6)</div><div class="q-en">How in the (ã€€ã€€ã€€) did you get this rare vase?<br>a. space / b. world / c. air / d. cloud</div><div class="merge-block"></div></div>
      </div>

      <div class="section">
        <h2>ç™ºå±•å•é¡Œï¼’ï½œä¸¦ã¹ã‹ãˆ <span class="tag">Emphasis etc.</span></h2>
        <div class="q-item" data-qid="a2-1"><div class="q-label">(1)</div><div class="q-jp">ã‚ãªãŸãŒãŠå…„ã•ã‚“ã‹ã‚‰ä¾¿ã‚Šã‚’ã‚‚ã‚‰ã£ãŸã®ã¯ã„ã¤ã§ã™ã‹ï¼</div><div class="q-raw">When [ from, heard, it, that, was, you ] your brother?</div><div class="merge-block"></div></div>
        <div class="q-item" data-qid="a2-2"><div class="q-label">(2)</div><div class="q-jp">ãã®è©±ã‚’èãã¨ã„ã¤ã‚‚å½¼ã®ã“ã¨ã‚’æ€ã„å‡ºã—ã¾ã™ï¼</div><div class="q-raw">I [ that, never, hear, without, story, remembering ] him.</div><div class="merge-block"></div></div>
        <div class="q-item" data-qid="a2-3"><div class="q-label">(3)</div><div class="q-jp">é›¢ã‚Œã¦ã¿ã¦åˆã‚ã¦è‡ªåˆ†ã®å›½ã®ã‚ˆã„ã¨ã“ã‚ãŒã‚ã‹ã‚‹ï¼</div><div class="q-raw">You [ leave, appreciate, you, donâ€™t, until, your own country ] it.</div><div class="merge-block"></div></div>
        <div class="q-item" data-qid="a2-4"><div class="q-label">(4)</div><div class="q-jp">å°‘ã—è€ƒãˆã‚Œã°ã‚ãªãŸã¯è‡ªåˆ†ãŒé–“é•ã£ã¦ã„ã‚‹ã“ã¨ã«æ°—ã¥ãã ã‚ã†ï¼</div><div class="q-raw">[ will make, a little, realize, you, reflection ] you are wrong.</div><div class="merge-block"></div></div>
      </div>

      <div class="section">
        <h2>ç™ºå±•å•é¡Œï¼“ï½œè‹±ä½œ <span class="tag">Output</span></h2>
        <div class="q-item" data-qid="a3-1"><div class="q-label">(1)</div><div class="q-jp">å¹é›ªã®ãŸã‚ã«å½¼å¥³ã¯å­¦æ ¡ã¸è¡Œã‘ãªã‹ã£ãŸï¼</div><div class="merge-block"></div></div>
        <div class="q-item" data-qid="a3-2"><div class="q-label">(2)</div><div class="q-jp">ç§ã¯ãã®çµæœã«ã¾ã£ãŸãæº€è¶³ã—ã¦ã„ãªã„ï¼</div><div class="merge-block"></div></div>
      </div>
    </section>

    <section class="pane" id="rightPane">
      <div class="pane-title">Hints / Answers</div>
      <div id="answerRoot"></div>
    </section>
  </main>
</div>

<script>
const DATA = {
  "b1-1": { hint:"ã€Œã»ã¨ã‚“ã©ã€œãªã„ã€ï¼‹æ•°ãˆã‚‰ã‚Œã‚‹åè© â†’ few + è¤‡æ•°åè©", answer:"Few people in our office know he is going to resign.", explain:"few ã¯æ•°ãˆã‚‰ã‚Œã‚‹åè©ã®å‰ã«ç½®ãã€ã€Œ(æ•°ãŒ)ã»ã¨ã‚“ã©ï½ãªã„ã€ã¨ã„ã†å¦å®šçš„æ„å‘³ã€‚ä¸å¯ç®—åè©ãªã‚‰ littleã€‚", jp:"ç§ãŸã¡ã®ä¼šç¤¾ã§å½¼ãŒè¾è·ã™ã‚‹ã“ã¨ã‚’çŸ¥ã£ã¦ã„ã‚‹äººã¯ã»ã¨ã‚“ã©ã„ãªã„ã€‚" },
  "b1-2": { hint:"ã€Œãƒ”ã‚¢ãƒãŒä¸Šæ‰‹ã€ï¼ good at piano ã˜ã‚ƒãªãã€Œã‚ˆã„ãƒ”ã‚¢ãƒã®å¼¾ãæ‰‹ã€", answer:"Kazuya is a good pianist.", explain:"ã€ˆå½¢å®¹è©ï¼‹åè©(ï¼å‹•ä½œè€…)ã€‰ã®å½¢ã§è¡¨ã™ã¨è‡ªç„¶ã€‚", jp:"ã‚«ã‚ºãƒ¤ã¯ãƒ”ã‚¢ãƒãŒä¸Šæ‰‹ã§ã™ã€‚" },
  "b1-3": { hint:"å¦å®šæ–‡ã®ã€Œã€œã‚‚ã¾ãŸâ€¦ãªã„ã€â†’ not ã€œ either", answer:"If Dick doesnâ€™t go to the festival, I wonâ€™t, either.", explain:"å…ˆè¡Œã™ã‚‹å¦å®šæ–‡ã‚’å—ã‘ã¦ã€Œï½ã‚‚ã¾ãŸâ€¦ã§ãªã„ã€ã¯ not ï½ eitherã€‚", jp:"ã‚‚ã—ãƒ‡ã‚£ãƒƒã‚¯ãŒãã®ç¥­ã‚Šã«è¡Œã‹ãªã„ãªã‚‰ã€åƒ•ã‚‚è¡Œã‹ãªã„ã€‚" },
  "b1-4": { hint:"ã€Œã‚ˆãä¼‘ã‚€ã€â†’ have a good rest", answer:"Did you have a good rest during the holidays?", explain:"ã€Œã‚ˆã„ä¼‘ã¿ã‚’ã¨ã‚‹ã€ã¨è€ƒãˆ ã€ˆå‹•è©ï¼‹å½¢å®¹è©ï¼‹åè©ã€‰ã§è¡¨ã™ã€‚", jp:"ä¼‘æš‡ä¸­ã¯ã‚ˆãä¼‘ã‚ã¾ã—ãŸã‹ã€‚" },
  "b1-5": { hint:"ã€Œã‚ã£ãŸã«ã€œãªã„ã€â†’ seldom / rarely", answer:"The writer seldom appears in public.", explain:"seldom/rarely ã¯é »åº¦ãŒéå¸¸ã«ä½ã„ï¼ã»ã¼å¦å®šã€‚", jp:"ãã®ä½œå®¶ã¯ã‚ã£ãŸã«äººå‰ã«å§¿ã‚’è¦‹ã›ãªã„ã€‚" },

  "b2-1": { hint:"ã€Œæœ€ã‚‚ã€œã—ãã†ã«ãªã„äººã€â†’ the last person to ã€œ", answer:"Ben would be the last person to betray us.", explain:"be unlikely to ã€œ ã®è‡ªç„¶ãªè¨€ã„æ›ãˆã€‚", jp:"" },
  "b2-2": { hint:"that ghosts exist ã‚’åè©åŒ– â†’ existence of ghosts", answer:"Some people are sure of the existence of ghosts.", explain:"ç¯€ã®å†…å®¹ã¯åè©æ§‹æ–‡ã«ã§ãã‚‹ã€‚", jp:"" },
  "b2-3": { hint:"not ã€œ any of ... = none of ...", answer:"I like none of these pictures.", explain:"none of + è¤‡æ•°åè© ã§å…¨ä½“å¦å®šã€‚", jp:"" },
  "b2-4": { hint:"ã€Œã€œã•ã›ã‚‹ã€â†’ make + O + åŸå½¢", answer:"What made him change his mind?", explain:"Why? ã‚’ What made him ... ã«å¤‰ãˆã‚‹ã€‚", jp:"" },
  "b2-5": { hint:"only = nothing but", answer:"What you are saying is nothing but an armchair theory.", explain:"nothing but ï¼ã€ŒãŸã ã€œã«ã™ããªã„ã€ã€‚", jp:"" },
  "b2-6": { hint:"å½¢å®¹è© + though/as S V", answer:"Tired though they were, they went on working late.", explain:"è­²æ­©ã®å€’ç½®æ§‹æ–‡ã€‚", jp:"" },

  "b3-1": { hint:"", answer:"ç§ã¯ã‚ˆãå›³æ›¸é¤¨ã¸è¡Œãã—ï¼Œç§ã®å…„[å¼Ÿ]ã‚‚ã‚ˆãè¡Œãï¼", explain:"so + V + S ã§ã€ŒSã‚‚ã¾ãŸã€œã™ã‚‹ã€ã€‚", jp:"" },
  "b3-2": { hint:"", answer:"è£•ç¦ã§ã¯ãªã„ã‹ã‚‰ã¨ã„ã£ã¦äººã‚’è»½ã¹ã¤ã™ã¹ãã§ã¯ãªã„ï¼", explain:"because ç¯€ã ã‘ã‚’å¦å®šã™ã‚‹å½¢ã€‚", jp:"" },
  "b3-3": { hint:"", answer:"è…¹ãŒç«‹ã£ãŸã‚‰ï¼Œè©±ã™å‰ã«10æ•°ãˆãªã•ã„ï¼", explain:"When (you are) angry ã®çœç•¥ã€‚", jp:"" },
  "b3-4": { hint:"", answer:"ç§ãŸã¡ã¯ã“ã“ã§å½¼ã‚’å¾…ã¤ã—ã‹ãªã„ï¼", explain:"have no choice but to do ï¼ã€Œã€œã™ã‚‹ã—ã‹ãªã„ã€ã€‚", jp:"" },
  "b3-5": { hint:"", answer:"ã“ã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã®ãŠã‹ã’ã§ç§ãŸã¡ã¯æ™‚é–“ã¨åŠ´åŠ›ã‚’çœãã“ã¨ãŒã§ãã‚‹ï¼", explain:"save O1 O2 ã®ç¬¬4æ–‡å‹ã€‚", jp:"" },

  "b4-1": { hint:"be sorry for not -ing", answer:"Iâ€™m sorry for not introducing myself sooner.", explain:"å¦å®šèª not ã¯å¦å®šã—ãŸã„èªå¥ã®ç›´å‰ã€‚", jp:"" },
  "b4-2": { hint:"It is ï½ that ... ã®å¼·èª¿æ§‹æ–‡ã€‚", answer:"It was this glass slipper that Cinderella wore at the ball.", explain:"å¼·èª¿ã—ãŸã„èªå¥ã‚’ It was ã¨ that ã®é–“ã¸ã€‚", jp:"" },
  "b4-3": { hint:"not ... any longer", answer:"I cannot stand the cold any longer.", explain:"ã€Œã‚‚ã¯ã‚„ã€œãªã„ã€ã€‚", jp:"" },
  "b4-4": { hint:"remind A of B", answer:"Your T-shirt reminds me of my country.", explain:"A remind B of ã€œã€‚", jp:"" },

  "b5-1": { hint:"enable O to do", answer:"The scholarship enabled him to go to university.", explain:"ç„¡ç”Ÿç‰©ä¸»èªã§ã€Œã€œã®ãŠã‹ã’ã§OãŒã§ãã‚‹ã€ã€‚", jp:"" },
  "b5-2": { hint:"Never ã‚’æ–‡é ­â†’å€’ç½®", answer:"Never have I seen such a beautiful sight.", explain:"å¦å®šå‰¯è©å‰ç½®ã§åŠ©å‹•è©å€’ç½®ã€‚", jp:"" },
  "b5-3": { hint:"Her letter says that ...", answer:"Her letter says (that) she will come back to Japan next week.", explain:"say/tell ã®ç„¡ç”Ÿç‰©ä¸»èªç”¨æ³•ã€‚", jp:"" },
  "b5-4": { hint:"neither + V + S", answer:"My father doesnâ€™t smoke, and neither do I.", explain:"å¦å®šå†…å®¹ã‚’å—ã‘ã‚‹å€’ç½®ã€‚", jp:"" },
  "b5-5": { hint:"the rumor that ...", answer:"Have you heard the rumor that they will get married?", explain:"åŒæ ¼ã® that ç¯€ã€‚", jp:"" },

  "fc-1": { hint:"", answer:"b. I hope not.", explain:"æœ›ã¾ã—ããªã„ã“ã¨ã«ã€Œãã†ã§ãªã„ã¨ã„ã„ã€ã€‚", jp:"" },
  "fc-2": { hint:"", answer:"a. No kidding.", explain:"é©šãã€Œã¾ã•ã‹ï¼ã€ã€‚", jp:"" },

  "a1-1": { hint:"beyond my control", answer:"d. beyond", explain:"ã€ŒåŠã°ãªã„ã€ï¼ beyondã€‚", jp:"" },
  "a1-2": { hint:"not ã€œ either", answer:"b. either", explain:"å¦å®šï¼‹ã€Œã€œã‚‚ã¾ãŸã€ã€‚", jp:"" },
  "a1-3": { hint:"anything but", answer:"a. anything", explain:"anything but perfectã€Œæ±ºã—ã¦å®Œå…¨ã§ãªã„ã€ã€‚", jp:"" },
  "a1-4": { hint:"enable O to do", answer:"d. enabled", explain:"enable ã®éå»åˆ†è©ã€‚", jp:"" },
  "a1-5": { hint:"far from", answer:"d. far", explain:"far from satisfyingã€‚", jp:"" },
  "a1-6": { hint:"How in the world", answer:"b. world", explain:"ç–‘å•å¼·èª¿ã®æ…£ç”¨å¥ã€‚", jp:"" },

  "a2-1": { hint:"When was it that ...?", answer:"When was it that you heard from your brother?", explain:"å¼·èª¿æ§‹æ–‡ã®ç–‘å•å½¢ã€‚", jp:"" },
  "a2-2": { hint:"never ã€œ without ...ing", answer:"I never hear that story without remembering him.", explain:"äºŒé‡å¦å®šã§ã€Œå¿…ãšã€ã€‚", jp:"" },
  "a2-3": { hint:"not ã€œ until ...", answer:"You donâ€™t appreciate your own country until you leave it.", explain:"ã€Œâ€¦ã—ã¦åˆã‚ã¦ã€ã€‚", jp:"" },
  "a2-4": { hint:"S will make O do", answer:"A little reflection will make you realize you are wrong.", explain:"make O do æ§‹æ–‡ã€‚", jp:"" },

  "a3-1": { hint:"prevent O from -ing", answer:"A snow storm prevented her from going to school.", explain:"ã€Œã€œã®ãŸã‚ã«è¡Œã‘ãªã„ã€â†’ preventã€‚", jp:"" },
  "a3-2": { hint:"not ã€œ at all", answer:"I am not satisfied with the result at all.", explain:"å¦å®šã‚’å¼·ã‚ã‚‹å‰¯è©å¥ã€‚", jp:"" }
};

const answerRoot = document.getElementById("answerRoot");
const leftItems = [...document.querySelectorAll("#leftPane .q-item[data-qid]")];

function labelFromQid(qid){
  const m = qid.match(/-(\d+)$/);
  return m ? `(${m[1]})` : "";
}
function hintText(d){
  return d.hint && d.hint.trim()
    ? d.hint
    : "ã“ã®å•é¡Œã¯ãƒ’ãƒ³ãƒˆãªã—ã€‚ã¾ãšè‡ªåŠ›ã§è§£ã„ã¦ã¿ã‚ˆã†ã€‚å¿…è¦ãªã‚‰è§£ç­”ã‚’é–‹ã„ã¦ç¢ºèªï¼";
}
function makeAnswerBlock(qid){
  const d = DATA[qid] || {};
  const wrap = document.createElement("div");
  wrap.className = "q-item";
  wrap.dataset.qid = qid;
  wrap.innerHTML = `
    <div class="q-label">${labelFromQid(qid)}</div>
    <div class="toggle-row">
      <button class="mini hint ${(!d.hint||!d.hint.trim())?'warn':''}" data-action="hint">ğŸ’¡ Hint</button>
      <button class="mini answer" data-action="answer">âœ… Answer</button>
    </div>
    <div class="ex">
      <div class="bubble hint ${(!d.hint||!d.hint.trim())?'warn':''}" data-box="hint">
        <div class="label">ğŸ’¡ HINT</div>
        <div>${hintText(d)}</div>
      </div>
      <div class="bubble answer" data-box="answer">
        <div class="label">âœ… ANSWER</div>
        <div><b>${d.answer||""}</b></div>
        ${d.explain?`<div style="margin-top:6px;">${d.explain}</div>`:""}
        ${d.jp?`<div class="jp">å’Œè¨³ï¼š${d.jp}</div>`:""}
      </div>
    </div>
  `;
  return wrap;
}
leftItems.forEach(li=>{
  const qid = li.dataset.qid;
  answerRoot.appendChild(makeAnswerBlock(qid));
});

function setupToggles(scope=document){
  scope.querySelectorAll(".mini").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const item = btn.closest(".q-item");
      if(!item) return;
      const action = btn.dataset.action;
      const box = item.querySelector(`.bubble.${action}`);
      if(box) box.classList.toggle("open");

      // After opening/closing, layout height changes -> rebuild maps + resync
      if(typeof refreshMaps === "function"){
        refreshMaps();
      }
    });
  });

  // When bubble finishes expanding/collapsing, resync again for perfect alignment
  scope.querySelectorAll(".bubble").forEach(bub=>{
    bub.addEventListener("transitionend", (e)=>{
      if(e.propertyName !== "max-height") return;
      if(typeof refreshMaps === "function"){
        refreshMaps();
      }
    });
  });
}
setupToggles();


function buildMergeBlocks(){
  leftItems.forEach(li=>{
    const qid = li.dataset.qid;
    const d = DATA[qid] || {};
    const mb = li.querySelector(".merge-block");
    if(!mb) return;
    mb.innerHTML = `
      <div class="toggle-row">
        <button class="mini hint ${(!d.hint||!d.hint.trim())?'warn':''}" data-action="hint">ğŸ’¡ Hint</button>
        <button class="mini answer" data-action="answer">âœ… Answer</button>
      </div>
      <div class="ex">
        <div class="bubble hint ${(!d.hint||!d.hint.trim())?'warn':''}" data-box="hint">
          <div class="label">ğŸ’¡ HINT</div>
          <div>${hintText(d)}</div>
        </div>
        <div class="bubble answer" data-box="answer">
          <div class="label">âœ… ANSWER</div>
          <div><b>${d.answer||""}</b></div>
          ${d.explain?`<div style="margin-top:6px;">${d.explain}</div>`:""}
          ${d.jp?`<div class="jp">å’Œè¨³ï¼š${d.jp}</div>`:""}
        </div>
      </div>
    `;
  });
  setupToggles(document.getElementById("leftPane"));
}
buildMergeBlocks();

function setHighlight(qid){
  document.querySelectorAll(".q-highlight").forEach(el=>el.classList.remove("q-highlight"));
  document.querySelectorAll(`.q-item[data-qid="${qid}"]`).forEach(el=>el.classList.add("q-highlight"));
}

// improved sync: choose item whose center is closest to top+120
const leftPane = document.getElementById("leftPane");
const rightPane = document.getElementById("rightPane");
const columns = document.getElementById("columns");
let lastQid=null, ticking=false;

function getCurrentLeftQidSmart(){
  const st = leftPane.scrollTop;
  const anchor = st + 140;
  let best=leftItems[0], bestDist=Infinity;
  for(const it of leftItems){
    const center = it.offsetTop + it.offsetHeight/2;
    const dist = Math.abs(center - anchor);
    if(dist < bestDist){ bestDist=dist; best=it; }
  }
  return best ? best.dataset.qid : null;
}
function scrollRightTo(qid){
  const target = rightPane.querySelector(`.q-item[data-qid="${qid}"]`);
  if(!target) return;
  rightPane.scrollTo({ top: target.offsetTop - 8, behavior:"smooth" });
}
leftPane.addEventListener("scroll", ()=>{
  if(columns.classList.contains("one-col")) return;
  if(ticking) return;
  ticking=true;
  requestAnimationFrame(()=>{
    const qid=getCurrentLeftQidSmart();
    if(qid && qid!==lastQid){
      lastQid=qid; setHighlight(qid); scrollRightTo(qid);
    }
    ticking=false;
  });
});
leftItems.forEach(it=>it.addEventListener("mouseenter", ()=>setHighlight(it.dataset.qid)));

const layoutBtn=document.getElementById("layoutBtn");
let twoCols=false;
layoutBtn.addEventListener("click", ()=>{
  twoCols=!twoCols;
  columns.classList.toggle("one-col", !twoCols);
  columns.classList.toggle("two-cols", twoCols);
  layoutBtn.textContent=twoCols?"ğŸ§± 2-Column":"ğŸ“„ 1-Column (Merge)";
  if(twoCols){
    const qid=getCurrentLeftQidSmart();
    if(qid){ lastQid=qid; setHighlight(qid); scrollRightTo(qid); }
  }
});
document.getElementById("themeBtn").addEventListener("click", ()=>document.body.classList.toggle("dark"));
document.getElementById("downloadBtn").addEventListener("click", ()=>{
  const fullHtml="<!DOCTYPE html>\n"+document.documentElement.outerHTML;
  const blob=new Blob([fullHtml],{type:"text/html"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url; a.download="grammar_breakdown_14_full_embed_v3.html";
  document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url);
});
window.addEventListener("load", ()=>{
  if(twoCols){
    const qid=getCurrentLeftQidSmart();
    if(qid){ lastQid=qid; setHighlight(qid); scrollRightTo(qid); }
  }
});

function refreshMaps(){
  buildOffsetMaps();
  if(columns.classList.contains("two-cols")) syncFromLeft();
}

</script>
</body>
</html>
